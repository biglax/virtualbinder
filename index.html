<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCG Binder Planner</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (to compile JSX in browser) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #0f172a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #475569; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icons ---
        const IconBase = ({ size = 24, className = "", children, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Search = (props) => (<IconBase {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /></IconBase>);
        const ImageIcon = (props) => (<IconBase {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><polyline points="21 15 16 10 5 21" /></IconBase>);
        const Plus = (props) => (<IconBase {...props}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></IconBase>);
        const Trash2 = (props) => (<IconBase {...props}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></IconBase>);
        const AlertCircle = (props) => (<IconBase {...props}><circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12.01" y2="16" /></IconBase>);
        const BookOpen = (props) => (<IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>);
        const DollarSign = (props) => (<IconBase {...props}><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconBase>);
        const Grid4 = (props) => (<IconBase {...props}><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></IconBase>);
        const Grid9 = (props) => (<IconBase {...props}><rect x="3" y="3" width="18" height="18" rx="2" /><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></IconBase>);
        const ChevronLeft = (props) => (<IconBase {...props}><polyline points="15 18 9 12 15 6" /></IconBase>);
        const ChevronRight = (props) => (<IconBase {...props}><polyline points="9 18 15 12 9 6" /></IconBase>);
        const HelpCircle = (props) => (<IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></IconBase>);
        const Edit = (props) => (<IconBase {...props}><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" /><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" /></IconBase>);
        const X = (props) => (<IconBase {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>);

        // --- Pricing Database (With your requested adjustments) ---
        const PRICE_DB = {
            'ex15-10': 138.0, 'base2-11': 70.0, 'ex6-15': 25.0, 'xy0-26': 30.13, 
            'base2-27': 55.0, 'base4-30': 55.0, 'col1-33': 25.0, 'gym1-33': 55.0, 
            'pl2-33': 55.0, 'dp1-37': 55.0, 'basep-49': 150.0, 'P-A-049': 55.0, 
            'sm115-50': 12.0, 'svp-051': 30.0, 'swsh10.5-055': 12.0, 'A3b-057': 13.0, 
            'g1-58': 4.6, 'A2a-063': 12.0, 'lc-64': 50.0, 'sv08.5-076': 13.0, 
            'xy10-77': 12.0, 'xy2-80': 12.0, 'pl2-81': 55.0, 'A3b-084': 13.0, 
            'A3b-091': 13.0, 'ecard3-100': 55.0, 'bw8-101': 8.0, 'ex7-104': 550.0, 
            'bw7-109': 4.37, 'swsh12.5-109': 12.0, 'pl2-111': 271.0, 'sv09-117': 12.0, 
            'xy8-118': 12.0, 'sm9-120': 13.0, 'svp-122': 55.0, 'swsh4-131': 12.0, 
            'sv06-136': 12.0, 'swsh1-140': 12.0, 'swsh1-141': 22.0, 'swsh2-141': 12.0, 
            'swsh1-142': 55.0, 'swsh11-143': 12.0, 'sv03.5-143': 12.0, 'sv08-144': 12.0, 
            'sm10-158': 74.0, 'sm9-171': 24.0, 'sv04-175': 12.0, 'svp-184': 55.0, 
            'sm9-191': 24.0, 'swsh1-197': 22.0, 'sv04.5-202': 32.0, 'swsh1-206': 90.0, 
            'swsh8-206': 12.0, 'A1-211': 12.0, 'swsh6-224': 175.0, 'A1-250': 12.0, 
            'smp-SM05': 24.0, 'swshp-SWSH032': 27.6, 'swshp-SWSH068': 30.1, 
            'swshp-SWSH119': 3.5, 'swsh11-TG10': 8.0, 'xyp-XY179': 12.2, 
            'pop3-1': 108.5, 'base4-2': 55.0, 'base1-2': 180.0, 'ex14-2': 75.0, 
            'pl1-2': 25.0, 'dp3-2': 25.0, 'base5-3': 210.0, 'lc-4': 50.0, 
            'ecard1-4': 150.0, 'sv03.5-009': 13.0, 'hgss2-13': 9.0, 'ex14-14': 25.0, 
            'bw10-16': 10.0, 'swsh10.5-017': 12.0, 'g1-17': 19.0, 'swsh10.5-018': 8.0, 
            'g1-18': 13.0, 'base5-20': 55.0, 'xy12-21': 55.0, 'xy12-22': 13.0, 
            'sm9-25': 55.0, 'xy1-29': 10.0, 'P-A-029': 55.0, 'xy1-30': 10.0, 
            'sv07-030': 13.0, 'bw7-31': 25.0, 'sm10-35': 17.0, 'ecard1-36': 42.0, 
            'ecard1-37': 45.0, 'sm12-38': 24.0, 'A1-055': 12.0, 'A1-056': 13.0, 
            'xy12-73': 12.0, 'xy12-102': 25.0, 'ex6-104': 25.0, 'bw8-137': 450.0, 
            'xy1-142': 13.0, 'sv03.5-184': 13.0, 'sv03.5-200': 170.0, 'sm12-214': 24.0, 
            'sm12-215': 24.0, 'A3-217': 12.0, 'sm10-218': 24.0, 'A3-232': 13.0, 
            'sm12-253': 130.0, 'A1-256': 13.0, 'swshp-SWSH101': 22.0, 
            'swshp-SWSH103': 55.0, 'xyp-XY122': 206.0, 'xyp-XY30': 55.0
        };

        const STORAGE_KEY = 'tcg_binder_data_v13';

        const Modal = ({ isOpen, title, onClose, children }) => {
            if (!isOpen) return null;
            return (
                <div className="absolute inset-0 z-50 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 animate-in fade-in duration-200">
                    <div className="bg-slate-900 border border-slate-700 rounded-xl shadow-2xl max-w-lg w-full overflow-hidden transform scale-100 transition-all flex flex-col max-h-[90vh]">
                        <div className="flex justify-between items-center p-4 border-b border-slate-800 bg-slate-800/50">
                            <h3 className="font-bold text-slate-200">{title}</h3>
                            <button onClick={onClose} className="text-slate-400 hover:text-white"><X size={20}/></button>
                        </div>
                        <div className="p-6 overflow-auto">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('official');
            const [binderPages, setBinderPages] = useState([]);
            const [availableCards, setAvailableCards] = useState([]);
            const [customImages, setCustomImages] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [dragItem, setDragItem] = useState(null); 
            const [errorMsg, setErrorMsg] = useState(null);
            const [pokemon, setPokemon] = useState('Snorlax'); 
            const [binderSize, setBinderSize] = useState(4);   
            const [totalValue, setTotalValue] = useState(0);
            const [isSidebarOpen, setIsSidebarOpen] = useState(true);
            const [showHelp, setShowHelp] = useState(false);

            // Modals
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, message: '', onConfirm: null });
            const [priceModal, setPriceModal] = useState({ isOpen: false, currentPrice: 0, onSave: null });

            useEffect(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        setPokemon(parsed.pokemon || 'Snorlax');
                        setBinderSize(parsed.binderSize || 4);
                        setCustomImages(parsed.customImages || []);
                        let pages = parsed.pages || [];
                        if (pages.length === 0) pages = [createPage(parsed.binderSize || 4)];
                        setBinderPages(pages);
                    } catch (e) {
                        setBinderPages([createPage(4)]);
                    }
                } else {
                    setBinderPages([createPage(4)]);
                    setShowHelp(true);
                }
            }, []);

            useEffect(() => { fetchCards(pokemon); }, [pokemon]);

            useEffect(() => {
                const data = { pages: binderPages, customImages, pokemon, binderSize };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                
                let val = 0;
                binderPages.forEach(page => {
                    page.slots.forEach(slot => {
                        if (slot && slot.type === 'standard' && slot.price) val += slot.price;
                    });
                });
                setTotalValue(val);
            }, [binderPages, customImages, pokemon, binderSize]);

            const getPrice = (cardId, cardName) => {
                // Return exact match from DB or default to 0.00
                return PRICE_DB[cardId] || 0.00;
            };

            const fetchCards = async (pokeName) => {
                setIsLoading(true);
                try {
                    const response = await fetch(`https://api.tcgdex.net/v2/en/cards?name=${pokeName}`);
                    const data = await response.json();
                    const cards = data.filter(c => c.image).map(c => ({
                        id: c.id,
                        name: c.name,
                        image: `${c.image}/low.webp`,
                        highRes: `${c.image}/high.webp`,
                        price: getPrice(c.id, c.name)
                    }));
                    setAvailableCards(cards);
                } catch (err) {
                    console.error("Failed to fetch cards", err);
                } finally {
                    setIsLoading(false);
                }
            };

            // --- Standard Logic ---
            const createPage = (size) => ({ id: Date.now() + Math.random(), slots: Array(size).fill(null) });
            const triggerConfirm = (message, action) => { setConfirmModal({ isOpen: true, message, onConfirm: action }); };
            
            const handleSizeChange = (newSize) => {
                if (newSize === binderSize) return;
                triggerConfirm("Changing binder size will reset your layout. This cannot be undone.", () => {
                    setBinderSize(newSize);
                    setBinderPages([createPage(newSize)]);
                });
            };

            const addSpread = () => { setBinderPages(prev => [...prev, createPage(binderSize), createPage(binderSize)]); };
            const removePages = (startIndex, count) => {
                triggerConfirm(`Remove ${count} page(s)? Cards on these pages will be lost.`, () => {
                    setBinderPages(prev => { const newPages = [...prev]; newPages.splice(startIndex, count); return newPages; });
                });
            };

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = () => { setCustomImages(prev => [...prev, { id: `custom-${Date.now()}`, content: reader.result }]); };
                reader.readAsDataURL(file);
            };
            const deleteCustomImage = (id) => { triggerConfirm("Delete this custom art?", () => { setCustomImages(prev => prev.filter(img => img.id !== id)); }); };

            const handleDragStart = (e, item) => { setDragItem(item); e.dataTransfer.effectAllowed = 'move'; };
            const handleDragOver = (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; };
            const handleDrop = (e, pageId, slotIndex) => {
                e.preventDefault();
                if (!dragItem) return;
                setErrorMsg(null);
                const newPages = [...binderPages];
                const pageIdx = newPages.findIndex(p => p.id === pageId);
                const targetPage = newPages[pageIdx];
                const cols = binderSize === 9 ? 3 : 2;
                
                if (dragItem.type === 'biglax') {
                    const colIndex = slotIndex % cols;
                    const isValidStart = (binderSize === 4 && colIndex === 0) || (binderSize === 9 && colIndex < 2);
                    if (!isValidStart) { shakeError("Biglax art needs 2 horizontal slots."); return; }
                    const neighborIndex = slotIndex + 1;
                    const isNeighborOccupied = targetPage.slots[neighborIndex] !== null;
                    const isSelf = dragItem.source === 'binder' && dragItem.sourcePageId === pageId && dragItem.sourceSlotIndex === slotIndex;
                    if (isNeighborOccupied && !isSelf) { shakeError("Not enough space! Right slot is occupied."); return; }
                }
                if (dragItem.source === 'binder') {
                    const oldPageIdx = newPages.findIndex(p => p.id === dragItem.sourcePageId);
                    newPages[oldPageIdx].slots[dragItem.sourceSlotIndex] = null;
                }
                if (dragItem.type === 'standard') {
                    const colIndex = slotIndex % cols;
                    if (colIndex > 0 && targetPage.slots[slotIndex - 1]?.type === 'biglax') { shakeError("Slot covered by Biglax art."); return; }
                }
                targetPage.slots[slotIndex] = { type: dragItem.type, content: dragItem.content, price: dragItem.price || 0, id: dragItem.id || Date.now() };
                if (dragItem.type === 'biglax') targetPage.slots[slotIndex + 1] = null;
                setBinderPages(newPages);
                setDragItem(null);
            };

            const removeCard = (pageId, slotIndex) => {
                const newPages = [...binderPages];
                const page = newPages.find(p => p.id === pageId);
                page.slots[slotIndex] = null;
                setBinderPages(newPages);
            };

            const triggerPriceEdit = (pageId, slotIndex, currentPrice) => {
                setPriceModal({
                    isOpen: true,
                    currentPrice,
                    onSave: (newPrice) => {
                        const newPages = [...binderPages];
                        const page = newPages.find(p => p.id === pageId);
                        if (page.slots[slotIndex]) page.slots[slotIndex].price = parseFloat(newPrice);
                        setBinderPages(newPages);
                    }
                });
            };

            const shakeError = (msg) => { setErrorMsg(msg); setTimeout(() => setErrorMsg(null), 3000); };

            const renderSlots = (page) => {
                const elements = [];
                const cols = binderSize === 9 ? 3 : 2;
                const totalSlots = binderSize;
                for (let i = 0; i < totalSlots; i++) {
                    const item = page.slots[i];
                    const colIndex = i % cols;
                    if (colIndex > 0 && page.slots[i-1]?.type === 'biglax') continue;
                    const isBiglax = item?.type === 'biglax';
                    let spanClass = isBiglax ? 'col-span-2' : 'col-span-1';
                    let aspectClass = isBiglax ? 'aspect-[5.2/3.5]' : 'aspect-[2.5/3.5]';
                    elements.push(
                        <div key={i} onDragOver={handleDragOver} onDrop={(e) => handleDrop(e, page.id, i)} className={`relative border-2 border-dashed border-slate-700/50 rounded-lg flex items-center justify-center bg-slate-800/50 overflow-hidden transition-all ${spanClass} ${aspectClass} hover:bg-slate-700/50 hover:border-slate-500`}>
                            <span className="absolute text-3xl font-bold text-slate-800 select-none pointer-events-none z-0">{i + 1}</span>
                            {item ? (
                                <div draggable onDragStart={(e) => handleDragStart(e, { ...item, source: 'binder', sourcePageId: page.id, sourceSlotIndex: i })} onContextMenu={(e) => { e.preventDefault(); removeCard(page.id, i); }} onDoubleClick={(e) => { e.stopPropagation(); triggerPriceEdit(page.id, i, item.price); }} className="w-full h-full cursor-grab active:cursor-grabbing z-10 relative group">
                                    <img src={item.content} className="w-full h-full object-cover rounded-md shadow-md" />
                                    {item.type === 'standard' && <div className="absolute top-1 right-1 bg-black/80 text-green-400 text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm font-mono border border-slate-700 shadow-md">${item.price.toFixed(2)}</div>}
                                    <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center transition-opacity gap-2">
                                        <div className="text-white text-xs font-bold bg-red-600/90 px-2 py-1 rounded shadow-sm pointer-events-none">Right-Click Remove</div>
                                        {item.type === 'standard' && <div className="text-slate-300 text-[10px] pointer-events-none bg-black/50 px-2 py-1 rounded">Double-Click Price</div>}
                                    </div>
                                </div>
                            ) : null}
                        </div>
                    );
                }
                return elements;
            };

            const pageWidthClass = binderSize === 9 ? 'w-[550px] min-h-[780px]' : 'w-[380px] min-h-[550px]';
            const pageGridClass = binderSize === 9 ? 'grid-cols-3' : 'grid-cols-2';

            const renderBinderContent = () => {
                if (binderPages.length === 0) return null;
                const spreads = [];
                spreads.push(
                    <div key="spread-first" className="flex flex-col items-center mb-16 relative group transition-all duration-300">
                        <button onClick={() => removePages(0, 1)} className="absolute -left-16 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-2 bg-slate-900 rounded-full"><Trash2 /></button>
                        <div className="flex shadow-2xl items-stretch">
                            <div className={`${pageWidthClass} bg-[#1a1c23] rounded-l-2xl border-y-4 border-l-4 border-slate-800 relative flex flex-col shadow-xl justify-center items-center overflow-hidden flex-shrink-0`}>
                                <div className="absolute inset-0 opacity-10 bg-[radial-gradient(#ffffff_1px,transparent_1px)] [background-size:16px_16px] pointer-events-none"></div>
                                <div className="absolute bottom-0 left-0 right-0 h-48 bg-[#22242b] border-t-2 border-slate-700/50 skew-y-[-2deg] origin-bottom-left mx-2 mb-2 rounded-sm shadow-inner"></div>
                                <div className="z-10 text-slate-600 font-bold text-lg tracking-widest opacity-50">INSIDE COVER</div>
                                <div className="absolute top-0 bottom-0 right-0 w-8 bg-gradient-to-l from-black/40 to-transparent pointer-events-none rounded-r-none"></div>
                            </div>
                            <div className="w-12 bg-[#111216] border-y-4 border-slate-900 relative z-20 flex flex-col justify-around py-12 shadow-2xl flex-shrink-0">
                                <div className="absolute inset-x-2 top-0 bottom-0 bg-[#1a1c23] border-x border-slate-700/30"></div>
                                {[1,2,3].map(k=><div key={k} className="relative w-full h-8 z-30 flex items-center justify-center"><div className="w-16 h-12 border-t-[6px] border-slate-400 rounded-[50%] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-lg"></div><div className="w-8 h-3 bg-slate-300 rounded-full shadow-md z-40 bg-gradient-to-b from-slate-200 to-slate-400"></div></div>)}
                            </div>
                            <div className={`${pageWidthClass} bg-[#1e2026] rounded-r-2xl border-y-4 border-r-4 border-slate-800 relative flex flex-col shadow-xl flex-shrink-0`}>
                                <div className="absolute inset-0 opacity-10 bg-[radial-gradient(#ffffff_1px,transparent_1px)] [background-size:16px_16px] pointer-events-none"></div>
                                <div className="flex-1 p-5 z-10"><div className={`grid ${pageGridClass} gap-3 h-full content-start`}>{renderSlots(binderPages[0])}</div></div>
                                <div className="text-center pb-2 text-slate-600 font-mono text-xs z-10">Page 1</div>
                                <div className="absolute top-0 bottom-0 left-0 w-8 bg-gradient-to-r from-black/40 to-transparent pointer-events-none rounded-l-none"></div>
                            </div>
                        </div>
                    </div>
                );
                for (let i = 1; i < binderPages.length; i += 2) {
                    const leftPage = binderPages[i];
                    const rightPage = binderPages[i+1];
                    spreads.push(
                        <div key={`spread-${i}`} className="flex flex-col items-center mb-16 relative group transition-all duration-300">
                            <button onClick={() => removePages(i, rightPage ? 2 : 1)} className="absolute -left-16 top-1/2 -translate-y-1/2 text-slate-600 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all p-2 bg-slate-900 rounded-full"><Trash2 /></button>
                            <div className="flex shadow-2xl items-stretch">
                                <div className={`${pageWidthClass} bg-[#1e2026] rounded-l-2xl border-y-4 border-l-4 border-slate-800 relative flex flex-col shadow-xl flex-shrink-0`}>
                                    <div className="absolute inset-0 opacity-10 bg-[radial-gradient(#ffffff_1px,transparent_1px)] [background-size:16px_16px] pointer-events-none"></div>
                                    <div className="flex-1 p-5 z-10"><div className={`grid ${pageGridClass} gap-3 h-full content-start`}>{renderSlots(leftPage)}</div></div>
                                    <div className="text-center pb-2 text-slate-600 font-mono text-xs z-10">Page {i + 1}</div>
                                    <div className="absolute top-0 bottom-0 right-0 w-8 bg-gradient-to-l from-black/40 to-transparent pointer-events-none rounded-r-none"></div>
                                </div>
                                <div className="w-12 bg-[#111216] border-y-4 border-slate-900 relative z-20 flex flex-col justify-around py-12 shadow-2xl flex-shrink-0">
                                    <div className="absolute inset-x-2 top-0 bottom-0 bg-[#1a1c23] border-x border-slate-700/30"></div>
                                    {[1,2,3].map(k=><div key={k} className="relative w-full h-8 z-30 flex items-center justify-center"><div className="w-16 h-12 border-t-[6px] border-slate-400 rounded-[50%] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-lg"></div><div className="w-8 h-3 bg-slate-300 rounded-full shadow-md z-40 bg-gradient-to-b from-slate-200 to-slate-400"></div></div>)}
                                </div>
                                <div className={`${pageWidthClass} bg-[#1e2026] rounded-r-2xl border-y-4 border-r-4 border-slate-800 relative flex flex-col shadow-xl flex-shrink-0`}>
                                    <div className="absolute inset-0 opacity-10 bg-[radial-gradient(#ffffff_1px,transparent_1px)] [background-size:16px_16px] pointer-events-none"></div>
                                    {rightPage ? (
                                        <><div className="flex-1 p-5 z-10"><div className={`grid ${pageGridClass} gap-3 h-full content-start`}>{renderSlots(rightPage)}</div></div>
                                        <div className="text-center pb-2 text-slate-600 font-mono text-xs z-10">Page {i + 2}</div></>
                                    ) : <div className="flex-1 flex items-center justify-center text-slate-700 italic opacity-30 text-xl font-bold">Back Cover</div>}
                                    <div className="absolute top-0 bottom-0 left-0 w-8 bg-gradient-to-r from-black/40 to-transparent pointer-events-none rounded-l-none"></div>
                                </div>
                            </div>
                        </div>
                    );
                }
                return spreads;
            };

            return (
                <div className="flex h-screen w-full bg-slate-950 text-slate-200 font-sans overflow-hidden">
                    
                    {/* Confirmation Modal */}
                    <Modal isOpen={confirmModal.isOpen} title="Are you sure?" onClose={() => setConfirmModal({ ...confirmModal, isOpen: false })}>
                        <p className="text-slate-300 mb-6">{confirmModal.message}</p>
                        <div className="flex justify-end gap-3">
                            <button onClick={() => setConfirmModal({ ...confirmModal, isOpen: false })} className="px-4 py-2 text-slate-400 hover:text-white transition-colors">Cancel</button>
                            <button onClick={() => { confirmModal.onConfirm && confirmModal.onConfirm(); setConfirmModal({ ...confirmModal, isOpen: false }); }} className="px-4 py-2 bg-red-600 hover:bg-red-500 text-white rounded font-medium">Confirm</button>
                        </div>
                    </Modal>

                    {/* Price Edit Modal */}
                    <Modal isOpen={priceModal.isOpen} title="Edit Card Price" onClose={() => setPriceModal({ ...priceModal, isOpen: false })}>
                        <p className="text-slate-400 text-xs mb-2">Set manual value in AUD</p>
                        <input 
                            type="number" step="0.01" defaultValue={priceModal.currentPrice} id="priceInput"
                            className="w-full bg-slate-800 border border-slate-600 rounded p-2 text-white mb-6 focus:border-teal-500 outline-none"
                        />
                        <div className="flex justify-end gap-3">
                            <button onClick={() => setPriceModal({ ...priceModal, isOpen: false })} className="px-4 py-2 text-slate-400 hover:text-white">Cancel</button>
                            <button onClick={() => { 
                                const val = document.getElementById('priceInput').value; 
                                if (val && priceModal.onSave) priceModal.onSave(val); 
                                setPriceModal({ ...priceModal, isOpen: false }); 
                            }} className="px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white rounded font-medium">Save Price</button>
                        </div>
                    </Modal>

                    {/* Help Modal */}
                    <Modal isOpen={showHelp} title="How to Use" onClose={() => setShowHelp(false)}>
                        <ul className="space-y-3 text-sm text-slate-300">
                            <li className="flex gap-2"><span className="text-teal-500 font-bold">1.</span> Drag cards or custom art into the binder.</li>
                            <li className="flex gap-2"><span className="text-teal-500 font-bold">2.</span> <strong className="text-white">Biglax Method:</strong> Custom art is "Double Wide". Drop in Left/Center columns.</li>
                            <li className="flex gap-2"><span className="text-teal-500 font-bold">3.</span> <strong className="text-white">Pricing:</strong> <span className="text-yellow-400">Double-Click</span> a card to edit price manually.</li>
                            <li className="flex gap-2"><span className="text-teal-500 font-bold">4.</span> <strong className="text-white">Removing:</strong> <span className="text-red-400">Right-Click</span> a card to remove it instantly.</li>
                        </ul>
                        <button onClick={() => setShowHelp(false)} className="mt-6 w-full py-2 bg-teal-600 hover:bg-teal-500 text-white rounded font-medium">Got it!</button>
                    </Modal>

                    {/* SIDEBAR */}
                    <div className={`flex-shrink-0 bg-slate-900 border-r border-slate-800 flex flex-col shadow-2xl z-20 transition-all duration-300 ${isSidebarOpen ? 'w-80' : 'w-0'}`}>
                        <div className={`flex flex-col h-full ${!isSidebarOpen && 'hidden'}`}>
                            {/* Header Area */}
                            <div className="p-4 border-b border-slate-800 bg-slate-900 z-20 space-y-4">
                                <div><h1 className="text-xl font-bold text-teal-400 flex items-center gap-2"><BookOpen size={20} /> TCG Planner</h1><p className="text-xs text-slate-500 mt-1 ml-7">Virtual Binder Manager</p></div>
                                <div className="space-y-3 bg-slate-800/50 p-3 rounded-lg border border-slate-700/50">
                                    <div className="flex items-center justify-between"><label className="text-xs font-medium text-slate-400">Binder Size</label><div className="flex bg-slate-900 rounded p-1"><button onClick={() => handleSizeChange(4)} className={`p-1.5 rounded ${binderSize === 4 ? 'bg-teal-600 text-white' : 'text-slate-500 hover:text-slate-300'}`}><Grid4 size={16} /></button><button onClick={() => handleSizeChange(9)} className={`p-1.5 rounded ${binderSize === 9 ? 'bg-teal-600 text-white' : 'text-slate-500 hover:text-slate-300'}`}><Grid9 size={16} /></button></div></div>
                                    <div className="flex items-center justify-between"><label className="text-xs font-medium text-slate-400">Pokemon</label><select value={pokemon} onChange={(e) => setPokemon(e.target.value)} className="bg-slate-900 border border-slate-700 text-xs text-slate-200 rounded px-2 py-1 outline-none focus:border-teal-500"><option value="Snorlax">Snorlax</option><option value="Blastoise">Blastoise</option></select></div>
                                </div>
                            </div>
                            {/* Tabs */}
                            <div className="flex border-b border-slate-800"><button onClick={() => setActiveTab('official')} className={`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${activeTab === 'official' ? 'bg-slate-800 text-teal-400 border-b-2 border-teal-400' : 'text-slate-400 hover:text-slate-200'}`}><Search size={16} /> Cards</button><button onClick={() => setActiveTab('custom')} className={`flex-1 py-3 text-sm font-medium flex items-center justify-center gap-2 transition-colors ${activeTab === 'custom' ? 'bg-slate-800 text-teal-400 border-b-2 border-teal-400' : 'text-slate-400 hover:text-slate-200'}`}><ImageIcon size={16} /> Custom</button></div>
                            {/* Card List */}
                            <div className="flex-1 overflow-y-auto p-4 custom-scrollbar bg-slate-900">
                                {activeTab === 'official' && (
                                    <div className="space-y-4">
                                        {isLoading ? <div className="text-center py-10 text-teal-500">Loading Market...</div> : 
                                            <div className="grid grid-cols-2 gap-3">
                                                {availableCards.map((card) => (
                                                    <div key={card.id} draggable onDragStart={(e) => handleDragStart(e, { type: 'standard', content: card.highRes, price: card.price, id: card.id, source: 'sidebar' })} className="aspect-[2.5/3.5] bg-slate-800 rounded-lg overflow-hidden cursor-grab active:cursor-grabbing hover:ring-2 hover:ring-teal-500 transition-all group relative border border-slate-800">
                                                        <img src={card.image} alt={card.name} className="w-full h-full object-cover" loading="lazy" />
                                                        <div className="absolute top-0 right-0 bg-slate-900/90 text-green-400 text-[10px] px-1.5 py-0.5 rounded-bl font-mono border-b border-l border-slate-700">A${card.price.toFixed(2)}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        }
                                    </div>
                                )}
                                {activeTab === 'custom' && (
                                    <div className="space-y-6">
                                        <div className="bg-slate-800 p-4 rounded-lg border border-slate-700 text-center"><p className="text-sm mb-3">Upload Biglax Art</p><label className="inline-flex items-center gap-2 px-4 py-2 bg-teal-600 hover:bg-teal-500 text-white text-sm rounded cursor-pointer transition-colors"><Plus size={16} /> Upload <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" /></label></div>
                                        <div className="grid grid-cols-1 gap-4">{customImages.map((img) => (<div key={img.id} className="relative group"><div draggable onDragStart={(e) => handleDragStart(e, { type: 'biglax', content: img.content, id: img.id, source: 'sidebar' })} className="aspect-[5/1.5] bg-slate-800 rounded-lg overflow-hidden cursor-grab active:cursor-grabbing border border-slate-700 hover:border-teal-500 transition-all"><img src={img.content} alt="Custom" className="w-full h-full object-cover" /></div><button onClick={() => deleteCustomImage(img.id)} className="absolute top-1 right-1 p-1 bg-red-600 text-white rounded opacity-0 group-hover:opacity-100 transition-opacity"><Trash2 size={12} /></button></div>))}</div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* MAIN AREA */}
                    <div className="flex-1 flex flex-col h-full bg-[#111] relative overflow-hidden">
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className={`absolute top-4 z-40 p-2 bg-slate-800 text-slate-300 border border-slate-700 rounded-r shadow-lg hover:text-white transition-all duration-300 ${isSidebarOpen ? 'left-0' : 'left-0'}`} title={isSidebarOpen ? "Collapse Sidebar" : "Expand Sidebar"}>{isSidebarOpen ? <ChevronLeft size={16}/> : <ChevronRight size={16}/>}</button>
                        <div className="h-16 border-b border-slate-800 flex items-center justify-between px-6 pl-12 bg-slate-900/80 backdrop-blur-sm z-30 shadow-md">
                            <div className="flex items-center gap-6">
                                <h2 className="text-slate-300 font-medium flex items-center gap-2">Binder View <span className="text-xs text-slate-500 bg-slate-800 px-2 py-0.5 rounded-full">{binderPages.length} pages</span></h2>
                                <div className="flex items-center gap-2 px-4 py-1.5 bg-slate-950 border border-slate-800 rounded-lg shadow-inner group relative">
                                    <div className="bg-green-900/30 p-1 rounded-full text-green-400"><DollarSign size={14} /></div>
                                    <div className="flex flex-col leading-none">
                                        <span className="text-[10px] text-slate-500 font-bold uppercase tracking-wider">Total Value (AUD)</span>
                                        <span className="text-lg font-mono text-green-400 font-medium">A${totalValue.toFixed(2)}</span>
                                    </div>
                                    <div className="absolute top-full left-0 mt-2 w-48 bg-black/90 text-slate-300 text-xs p-2 rounded shadow-xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity">Based on snapshot pricing. Double-click to edit manually.</div>
                                </div>
                            </div>
                            <div className="flex gap-4">
                               {errorMsg && <div className="flex items-center gap-2 text-red-400 text-sm animate-pulse font-medium bg-red-900/20 px-3 py-1 rounded-full"><AlertCircle size={16} /> {errorMsg}</div>}
                               <button onClick={() => setShowHelp(true)} className="p-2 text-slate-400 hover:text-teal-400 transition-colors" title="Help"><HelpCircle size={20}/></button>
                               <button onClick={addSpread} className="flex items-center gap-2 text-sm bg-teal-700 hover:bg-teal-600 text-white px-4 py-1.5 rounded-md shadow-lg transition-all hover:translate-y-[-1px]"><Plus size={16} /> Add Pages</button>
                            </div>
                        </div>
                        <div className="flex-1 overflow-auto p-8 custom-scrollbar bg-[#0a0a0c] relative">
                            <div className="absolute inset-0 opacity-20 bg-[radial-gradient(#334155_1px,transparent_1px)] [background-size:24px_24px] pointer-events-none"></div>
                            <div className="min-w-fit flex flex-col items-center space-y-8 pb-20 transition-all duration-500">{renderBinderContent()}
                                {binderPages.length === 0 && <div className="text-center py-20 opacity-50 flex flex-col items-center"><div className="p-4 bg-slate-800 rounded-full mb-4"><Plus size={32}/></div><p>Your binder is empty.</p></div>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>